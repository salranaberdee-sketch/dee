# Flow Diagram: ระบบประเมินผลนักกีฬา

## ภาพรวมความสัมพันธ์ของข้อมูล

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           FLOW การประเมินผลนักกีฬา                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────────────────────┐   │
│  │  schedules  │     │   events    │     │      training_logs          │   │
│  │  (นัดหมาย)  │     │ (กิจกรรม)   │     │    (บันทึกฝึกซ้อม)          │   │
│  └──────┬──────┘     └──────┬──────┘     └─────────────┬───────────────┘   │
│         │                   │                         │                    │
│         │ schedule_id       │ event_id                │ athlete_id         │
│         │                   │                         │ duration           │
│         ▼                   ▼                         │ rating (1-5)       │
│  ┌──────────────────────────────────────┐             │                    │
│  │       attendance_records             │             │                    │
│  │       (บันทึกการเข้าร่วม)             │             │                    │
│  │                                      │             │                    │
│  │  • on_time (มาตรงเวลา)               │             │                    │
│  │  • late (มาสาย)                      │             │                    │
│  │  • leave (ลา) ← LeaveRequest.vue     │             │                    │
│  │  • absent (ขาด)                      │             │                    │
│  └──────────────────┬───────────────────┘             │                    │
│                     │                                 │                    │
│                     │ athlete_id                      │                    │
│                     ▼                                 ▼                    │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                    CALCULATION (คำนวณคะแนน)                          │  │
│  │                                                                      │  │
│  │  attendance_score = (on_time + late) / total * 100 * 0.4  (40%)     │  │
│  │  training_score = (sessions / 12) * 30                    (30%)     │  │
│  │  rating_score = (avg_rating / 5) * 30                     (30%)     │  │
│  │                                                                      │  │
│  │  overall_score = attendance_score + training_score + rating_score   │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                     │                                                      │
│                     ▼                                                      │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                    PERFORMANCE TIER (ระดับผลงาน)                     │  │
│  │                                                                      │  │
│  │  ⭐ excellent (ดีเยี่ยม)     : score ≥ 85                           │  │
│  │  ✓  good (ดี)               : score ≥ 70                            │  │
│  │  ○  average (ปานกลาง)       : score ≥ 50                            │  │
│  │  ⚠  needs_improvement       : score < 50                            │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Flow สำหรับแต่ละ Role

### 1. Admin/Coach Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                      ADMIN/COACH FLOW                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. สร้างนัดหมาย/กิจกรรม                                        │
│     └─► schedules / events                                      │
│                                                                 │
│  2. บันทึกการเข้าร่วม (AttendanceManager.vue)                   │
│     └─► เลือกวันที่ + กิจกรรม                                   │
│     └─► Mark สถานะนักกีฬาแต่ละคน                                │
│     └─► บันทึกลง attendance_records                             │
│                                                                 │
│  3. ให้คะแนนฝึกซ้อม (TrainingLogs.vue)                          │
│     └─► ให้ rating 1-5 ดาว                                      │
│     └─► บันทึกลง training_logs                                  │
│                                                                 │
│  4. ดูผลประเมิน (EvaluationDashboard.vue)                       │
│     └─► ดูภาพรวมนักกีฬาทั้งหมด                                  │
│     └─► กรองตาม tier                                            │
│     └─► Export รายงาน                                           │
│                                                                 │
│  5. อนุมัติการลา                                                │
│     └─► ดูคำขอลาที่รออนุมัติ                                    │
│     └─► อนุมัติ/ปฏิเสธ                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2. Athlete Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                       ATHLETE FLOW                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. ดูนัดหมาย/กิจกรรมที่กำลังจะมาถึง                            │
│     └─► Schedules.vue / Events.vue                              │
│                                                                 │
│  2. ขอลา (LeaveRequest.vue)                                     │
│     └─► เลือกกิจกรรมที่ต้องการลา (จาก schedules/events)         │
│     └─► เลือกประเภทการลา (ป่วย/กิจ/ฉุกเฉิน/อื่นๆ)               │
│     └─► ระบุเหตุผล                                              │
│     └─► ส่งคำขอ → attendance_records (status='leave')           │
│                                                                 │
│  3. บันทึกฝึกซ้อม (TrainingLogs.vue)                            │
│     └─► บันทึกกิจกรรมที่ฝึก                                     │
│     └─► ระบุระยะเวลา                                            │
│     └─► บันทึกลง training_logs                                  │
│                                                                 │
│  4. ดูผลงานของตัวเอง (AthletePerformance.vue)                   │
│     └─► ดูคะแนนรวม + tier ปัจจุบัน                              │
│     └─► ดูเป้าหมายถัดไป + คะแนนที่ต้องเพิ่ม                     │
│     └─► ดูวิธีเพิ่มคะแนน (3 ส่วน)                               │
│     └─► ดูคำแนะนำเฉพาะบุคคล                                     │
│     └─► ดูประวัติการเข้าร่วม                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Database Relationships

```sql
-- ความสัมพันธ์หลัก
attendance_records.athlete_id → athletes.id
attendance_records.schedule_id → schedules.id
attendance_records.event_id → events.id
attendance_records.club_id → clubs.id

training_logs.athlete_id → athletes.id
training_logs.club_id → clubs.id

athlete_evaluations.athlete_id → athletes.id
athlete_evaluations.club_id → clubs.id

-- ทุกตารางเชื่อมกับ club_id เพื่อแยกข้อมูลตามชมรม
```

## สิ่งที่มีผลต่อคะแนน

| แหล่งข้อมูล | ส่งผลต่อ | น้ำหนัก |
|------------|---------|--------|
| attendance_records (on_time) | attendance_rate | 40% |
| attendance_records (late) | attendance_rate | 40% |
| attendance_records (leave) | ไม่นับเป็นเข้าร่วม | - |
| attendance_records (absent) | ไม่นับเป็นเข้าร่วม | - |
| training_logs (count) | training_sessions | 30% |
| training_logs (rating) | average_rating | 30% |

## เป้าหมายสำหรับนักกีฬา

| เป้าหมาย | ค่าที่ต้องการ | คะแนนที่ได้ |
|---------|-------------|-----------|
| เข้าร่วม 100% | 100% | 40 คะแนน |
| ฝึกซ้อม 12 ครั้ง/เดือน | 12 ครั้ง | 30 คะแนน |
| Rating 5 ดาว | 5.0 | 30 คะแนน |
| **รวมสูงสุด** | | **100 คะแนน** |
